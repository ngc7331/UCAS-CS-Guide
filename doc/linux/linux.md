# linux
想必大家都不乐意阅读冗长而没什么用的介绍。因此本文将尽可能精简，更多的资料将以

- [这样的补充阅读链接]()

的形式附在每节正文的末尾。**其中标有\*的内容为英文资料。**

## 目录
- [linux](#linux)
  - [目录](#目录)
  - [Linux 系统、发行版简要介绍](#linux-系统发行版简要介绍)
    - [什么是 Linux](#什么是-linux)
    - [什么是发行版](#什么是发行版)
    - [Ubuntu](#ubuntu)
  - [图形化与命令行](#图形化与命令行)
    - [读懂终端](#读懂终端)
  - [重要概念](#重要概念)
    - [大小写敏感](#大小写敏感)
    - [空格与引号](#空格与引号)
    - [权限](#权限)
      - [用户权限](#用户权限)
      - [文件权限](#文件权限)
    - [目录与路径](#目录与路径)
      - [绝对路径](#绝对路径)
      - [相对路径](#相对路径)
      - [工作目录](#工作目录)
      - [用户目录（主目录）](#用户目录主目录)
    - [回显](#回显)
    - [输入Y确认](#输入y确认)
  - [与 windows 的不同](#与-windows-的不同)
    - [大小写敏感](#大小写敏感-1)
    - [快捷键](#快捷键)
  - [常用指令](#常用指令)
    - [切换当前工作目录 `cd`](#切换当前工作目录-cd)
    - [输出当前工作目录 `pwd`](#输出当前工作目录-pwd)
    - [列出目录文件](#列出目录文件)
      - [`ls`](#ls)
      - [`tree`](#tree)
    - [创建文件 `touch`、创建目录 `mkdir`](#创建文件-touch创建目录-mkdir)
    - [编辑文件](#编辑文件)
    - [移动 `mv`、复制`cp`](#移动-mv复制cp)
    - [删除](#删除)
      - [删除空目录 `rmdir`](#删除空目录-rmdir)
      - [删除文件 `rm`](#删除文件-rm)
    - [输出文件](#输出文件)
      - [输出全文 `cat`](#输出全文-cat)
      - [输出头行 `head`、输出尾行 `tail`](#输出头行-head输出尾行-tail)
      - [输出差异 `diff`](#输出差异-diff)
    - [更改文件权限 `chmod`](#更改文件权限-chmod)
    - [更改文件所有者 `chown`](#更改文件所有者-chown)
    - [用户手册 `man`](#用户手册-man)
    - [`grep`](#grep)
    - [切换用户 `su`](#切换用户-su)
    - [`sudo`](#sudo)
    - [与 `&&`、或 `||`](#与-或-)
    - [管道符 `|`](#管道符-)
    - [输出重定向符 `>`、 `>>`](#输出重定向符--)
    - [安装软件](#安装软件)
    - [`ssh`](#ssh)
    - [`git`](#git)
    - [退出 `exit`](#退出-exit)

---
## Linux 系统、发行版简要介绍
### 什么是 Linux
与常见的 Windows、MacOS 相同，Linux 也是一个操作系统，一般用于开发和服务器领域。

- \*[What is Linux?](https://www.linux.com/what-is-linux/)
- [Linux 简介](https://www.runoob.com/linux/linux-intro.html)

### 什么是发行版
Linux 的内核非常小，功能也不多。为了便于人们使用，有许多组织在它的基础上修改和新增了大量软件包并重新发布。这些版本仍属于 Linux，称为 Linux 发行版（Distribution）。

亦有些发行版是基于其它发行版进一步修改得到的。

类比安卓手机，谷歌推出了基础的 Android 系统，而各大手机厂家为了满足本地化的用户需求对它进行了修改。产生了诸如小米 MIUI，华为 EMUI，OPPO ColorOS等衍生版本。

常见的发行版有 Debian、Ubuntu、Arch、Mint、RedHat 等
![常见发行版汇总图](https://www.runoob.com/wp-content/uploads/2014/06/wKioL1bvVPWAu7hqAAEyirVUn3c446.jpg-wh_651x-s_3197843091.jpg)
> 图源：菜鸟教程

而在我们UCAS的课程中，最常使用的发行版为 Ubuntu，因此本指南将以它作为基础。

不同发行版之间可能存在差异，例如 Debian/Ubuntu 采用`apt`作为软件包管理器，而 RedHat 采用`rpm`。因此在使用别人的代码时应留意发行版是否一致，在向他人求助时也请主动提供您的发行版信息。

- \*[Distrowatch](https://distrowatch.com/)：发行版列表及榜单
- \*[Debian is the rock on which Ubuntu is built](https://ubuntu.com/community/debian)：Ubuntu 官网对 Ubuntu 和 Debian 关系的介绍

### Ubuntu
Ubuntu 是由 Canonical Ltd. 构建的 Linux 发行版，拥有桌面版、服务器版、物联网版等分支。

Ubuntu 每六个月（每年的4月和10月）发布一个新版本，每两年发布一个长期支持（LTS）版，版本号标识为
```
Ubuntu yy.mm.x
```
例如`Ubuntu 20.04.3 LTS`表示为2020年04月发布的 LTS 版本的第三次小更新

不同版本间的 Ubuntu 亦可能存在差异，请留意。

- [Ubuntu 中文官网](https://cn.ubuntu.com/)
- \*[What is an Ubuntu LTS release?](https://ubuntu.com/blog/what-is-an-ubuntu-lts-release)



---
## 图形化与命令行
尽管大部分 Linux 发行版都可以像 Windows 一样使用支持鼠标的图形化界面，主流的在 Linux 上进行开发的方式还是使用纯键盘的命令行模式。主要理由如下：
- 图形化界面比较占用资源
- 做开发时大部分时间只需要打开编辑器、使用键盘输入代码，没有必要使用图形化界面
- 有些软件的图形化界面支持并不稳定，会产生预期以外的错误
- 有时开发是在远程服务器上进行的，传输图形化界面对网络要求高

我校课程对于 Linux 的使用也通常只需要命令行即可完成，例如程序设计基础与实验（C 语言）课程的武成岗老师班，要在 Linux 中完成的操作有：
1. 编辑代码
2. 使用`gcc`编译
3. 运行并查看结果

后两步都是纯命令行操作，第一步大家的做法不尽相同，有使用`gedit`/`vscode`这类图形化界面的，亦有使用`vi`/`nano`的，关于这些编辑器更详细的介绍和对比请看[编辑器](editor.md)页面。

特别的，`vscode`虽然是一个图形化程序，但可以使用 Windows 下的 `vscode` 通过插件和`ssh`连接到 Linux 系统，从而避免使用 Linux 的图形化界面。个人也是**强烈推荐**这个方式，详见[编辑器](editor.md)页面。

综上，本指南在大多数情况下也只会涉及到命令行（终端）的部分，希望大家能适应这种模式。

### 读懂终端
打开终端后，您可能会见到类似下面这样的字符：
```
ubuntu@server-7anw4ytc:~$
```
其格式为
```
用户名@主机名:工作目录$
```
下面逐项解释：
- 用户名：当前登录到系统使用的用户名称
- `@`：和邮箱中的`user@site.domain`作用相似，某个主机下的某个用户
- 主机名：当前系统的主机名（hostname）
- 工作目录：当前所处的目录，记法请见[目录与路径](#目录与路径)一节
- `$`/`#`：前者表示当前用户**不是** root，后者则表示是 root

出现上面的`user@host:/dir$`时意味着可以向终端输入指令



---
## 重要概念
### 大小写敏感
一般情况下，Linux 系统对大小写敏感，例如`./cod-lab`与`./COD-Lab`对 Linux 来说是两个不同的目录，切换目录时要用`cd`而非`CD`等

### 空格与引号
Linux 终端使用空格来分割指令参数，当某一个参数中需要包含空格时，用引号包裹

例如用`touch`指令创建一个叫`this is a file`的文件，如果不加引号
```
$ touch this is a file
$ ls
a  file  is  this
```
可见他把`this`, `is`, `a`, `file`理解成了4个独立的参数，从而分别创建了这4个文件
```
$ touch "this is a file"
$ ls
'this is a file'
```
注意，除非使用转义符，引号自身不会被当作字符串的一部分，因此创建的文件名中不会包括引号。`ls`的结果看似是包含了单引号，实际上那只是为了人能准确理解自动添加的。

单双引号有区别，但一般涉及不到，请自行搜索

### 权限
简单来说，Linux 下有两类权限：
#### 用户权限
- root 权限（超级用户权限）：系统最高权限，甚至可以把系统本身删掉。当做出某些敏感操作（安装软件，修改系统配置等）时需要 root 权限
- root 用户（超级用户）：任何 Linux 系统中都有且仅有一个 root 用户，具有 root 权限，处于安全考虑，请避免直接使用该用户
- 普通用户：平时不具有 root 权限，需要使用时可通过`sudo`临时获取，详见[常用指令](#常用指令)
- 用户组：为方便管理，把需要相同权限的多个用户加入一个组，用户组可以具有一些独立的权限

#### 文件权限
文件有3类权限：读、写、执行，一般以1位8进制数或者包含{w, r, x, -}的字符串表示

Note：这三个权限彼此独立，可以做到一个用户能写入和执行而不能读取

一个文件针对用户、用户组、任何人可以有不同的权限，因此总共需要3位8进制数或者三组{w, r, x, -}表示权限

此外还需要标注文件是否为目录，用1位2进制表示

例如，通过`ls -al`查看详细文件列表时：
```
$ ls -al
total 12
drwxrwxr-x 3 user group 4096 3月   5 15:16 ./
drwxr-xr-x 3 user group 4096 3月   5 14:45 ../
drwxrwxr-x 2 user group 4096 3月   5 15:15 some-dir/
-rw-rw-r-- 1 user group    0 3月   5 15:16 some-file.txt
-rwxrwxr-x 1 user group    0 3月   5 15:16 some-script.sh*
-rw------- 1 user group    0 3月   5 15:16 some-secret-file.txt
```
可以看到每行开头有一串字符串：
- 第三行开头的`drwxrwxr-x`中
  * 第一个字母`d`表示这是一个目录
  * 第一组`rwx`表示本**用户**具有读、写、执行权限
  * 第二组`rwx`表示本**用户组**也具有这三个权限
  * 第三组`r-x`表示**任何人**只具有读、执行权限而不具有写权限
  * `user`和`group`分别表示**文件所属**的用户名和用户组名
- 最后一行`-rw-------`开头的`-`表示这不是目录，随后的`rw-`表示本用户具有读、写权限，后面的两组`---`表示本用户组和任何人不具有任何权限

再比如，通过`chmod`变更文件权限：
```
$ ls -al
-rw-rw-r-- 1 user group    0 3月   5 15:16 some-script.sh
$ chmod +x some-script.sh
$ ls -al
-rwxrwxr-x 1 user group    0 3月   5 15:16 some-script.sh*
$ chmod 750 some-script.sh
-rwxr-x--- 1 user group    0 3月   5 15:16 some-script.sh*
```
- `chmod +x`表示为该文件增加可执行权限，类似的有`+r`、`+w`表示增加读、写权限，也有`-r`、`-w`、`-x`表示撤销这三个权限
- `chmod 750`则是使用了3位8进制数表达，写成二进制`111 101 000`后与三组`rwx`的记法一一对应：本用户`111=rwx`，本用户组`101=r-x`，任何人`000=---`

### 目录与路径
#### 绝对路径
以根目录`/`开始的路径

Note：`/`有两种含义，一是根目录（必须是最开头的字符），二是表示层级关系，例如
```
/home/user/some-file.txt
```
中的第一个`/`表示根目录，后面的两个`/`则表示“目录`user`在目录`home`中”、“文件`some-file.txt`在目录`user`中”的层级关系

#### 相对路径
假设当前工作目录的绝对路径为`/home/user`
1. `some-file.txt`为当前目录下叫`some-file.txt`的文件，其绝对路径为`/home/user/some-file.txt`
2. `.`表示当前目录，因此`./some-file.txt`同上
3. `..`表示当前目录的上级目录，因此`../user/some-file.txt`同上
4. 没有`.../`的表示方法！如果要表示上级的上级，应该使用`../../`

#### 工作目录
Linux 下有些命令与目录无关，如`apt update`，但大部分命令均与目录有关，因此请务必留心您所处的工作目录。

查看当前工作目录有两个方法：
1. 直接从终端信息中得到，参考[读懂终端](#读懂终端)一节
2. 使用`pwd`指令获得

#### 用户目录（主目录）
每个用户有一个默认的登录目录，称为用户目录，一般是`/home/<用户名>`，例如`user`用户的用户目录为`/home/user`

用户目录用`~`表示，因此在上例中`~/some-file.txt`和`/home/user/some-file.txt`是同一个文件

Review：`~/`也是一种相对路径记法

### 回显
当我们进行输入时，通常屏幕上会即时显示出我们输入的内容，称为回显

即使是输入密码等敏感字段，也会有诸如`***`和`···`的回显证明确实输入进去了

而在 Linux 终端中输入密码等敏感字段时，通常屏幕上**不会有任何回显**，按下回车后才能看到相应的结果（成功执行或密码错误等）

请放心大胆地完成输入

### 输入Y确认
有时在执行一条命令时会出现下面这样的提示
- `Are you sure you want to continue connecting (yes/no)?`
- `Do you want to continue? [Y/n]`

如果您确认命令输入正确且目前没有非预期的输出，则按提示输入`y`，`yes`等即可继续执行，否则输入`n`，`no`取消执行

值得注意的是，**大部分**时候：
- 该步骤不区分大小写
- 可以使用首字母简写法，即`y`和`n`分别代表确认和取消
- 在可选项中有一个默认选项，以大写表示。例如上例中的`[Y/n]`默认为确认，这意味着您不输入任何字符直接按下回车时将确认该操作。同理`[y/N]`默认为取消。
  * Note: 默认为取消的操作可能意味着该操作有一定风险，例如覆盖已有的配置文件、产生安全漏洞等。


---
## 与 windows 的不同
### 大小写敏感
同[重要概念/大小写敏感](#大小写敏感)
### 快捷键
需要留心的是，Windows 下的快捷键大多数在 Linux 终端中不起作用：
- 在`vi`中`Ctrl + S`不能保存文件，`:w`才可以
- 在`nano`中`Ctrl + S`也不能保存文件，`Ctrl + W`才可以

有些甚至会造成事故：
- 复制的快捷键`Ctrl + C`在终端中表示发送一个`SIGINT`信号，简单来说代表“强制终止当前执行的命令”。

此外，Linux 下的快捷键与终端软件、发行版等很多因素有关，因此请自行查找您使用的 Linux 环境下快捷键的说明。

建议您在熟悉 Linux 环境前适当减少快捷键的使用。

- [Linux 中的信号](http://c.biancheng.net/view/3482.html)



---
## 常用指令
下面只列出最基础的用法，如需了解指令的更多参数和用法请自行查找资料

用中括号`[]`包裹的参数为可选参数

一般而言，可以用`man cmd`或`cmd --help`或`cmd -h`查看关于命令`cmd`的说明和帮助

俗话说“没有消息就是最好的消息”，Linux 下很多指令**成功执行时都没有输出**，只要确认输入正确，就无需担心运行结果是否正确。如仍需校验结果，常常需要使用不同指令辅助。

- [Linux 命令大全](https://www.runoob.com/linux/linux-command-manual.html)

### 切换当前工作目录 `cd`
- 用法：`cd [<path>]`
- Change Directory，切换当前工作目录至`path`，或者说移至（打开）`path`
- `path`可以使用绝对路径或相对路径表示
- 特殊用法：
  * `path`缺省时默认为用户目录`~`，即`cd`等价于`cd ~`
  * `cd -`：回到上个访问的目录

### 输出当前工作目录 `pwd`
- 用法：`pwd`
- Print Work Directory，输出当前工作目录的绝对路径

### 列出目录文件
#### `ls`
- 用法：`ls [-a] [-l] [<path>]`
- 列出`path`下的所有文件（夹）
- `path`缺省时默认为当前目录`.`，即`ls`等价于`ls .`
- 使用`-a`时列出包括隐藏文件（`.`开头的文件）
- 使用`-l`时列出包括文件权限、大小、创建时间在内的详细信息（类比 Windows 资源管理器从列表模式改成详细信息模式）

#### `tree`
- 用法：`tree <path>`
- 列出`path`下的所有文件（夹）和所有子文件（夹），用文件树的形式输出
- `path`默认为当前目录`.`，即`ls`等价于`ls .`

### 创建文件 `touch`、创建目录 `mkdir`
- 用法：`touch <name>`、`mkdir <name>`
- 创建一个叫`name`的空文件/空目录

### 编辑文件
- 见[编辑器](editor.md)一节

### 移动 `mv`、复制`cp`
- 用法：`mv <src> <dst>`、`cp <src> <dst>`
- 将文件从`src`移动/复制到`dst`
- `dst`可以为
  * 一个已存在的目录，此时会把`src`移动/复制到该目录下
  * 一个不存在的文件/目录，此时`src`必须为一个文件/目录
- `src`可以是多个文件，此时`dst`必须为一个已存在的目录

### 删除
#### 删除空目录 `rmdir`
- 用法：`rmdir <dir>`
- 将空目录`dir`删除，若非空则报错
#### 删除文件 `rm`
- 用法：`rm [-R] <path>`
- 删除`path`指定的文件
- 使用`-R`时采用递归删除的方式，删除`path`指定的目录和其中所有的子目录/文件。不使用`-R`而`path`为目录时报错

### 输出文件
#### 输出全文 `cat`
- 用法：`cat <file>`
- 输出`file`的内容
- Note：当文件过大时可能造成卡顿，请考虑使用`head`或`tail`

#### 输出头行 `head`、输出尾行 `tail`
- 用法：`head <file> [-n <lines>]`、`tail <file> [-n <lines>]`
- 输出`file`头部/尾部`lines`行的内容，默认为10行

#### 输出差异 `diff`
- 用法：`diff <file1> <file2>`
- 逐行比较两个文件的差异并输出不同的行
- 如果两个文件没有差异则**无输出**

### 更改文件权限 `chmod`
- 用法：`chmod <permission> <path>`
- 将`path`指定的文件（夹）赋予权限`permission`，它可以是
  * `+r`，`+w`，`+x`，表示授予读、写、执行权限
  * `-r`，`-w`，`-x`，表示撤销读、写、执行权限
  * 上面写法可以连用，例如`+rw`表示授予读写权限
  * 3位8进制数，见[文件权限](#文件权限)一节

### 更改文件所有者 `chown`
- 用法：`chown <user>:<group> <path>`
- 将`path`指定的文件（夹）的所有者更改为`user:group`

### 用户手册 `man`
- 用法：`man <指令>`
- 查看指令的用户手册

### `grep`
- 用法：`grep [-i] <text> <file>`
- 在文件`file`中查找带有`text`的行并输出
- 使用`-i`时忽略大小写
- 常与[管道符](#管道符)联合使用

### 切换用户 `su`
- 用法：`su [<user>]`
- 切换至`user`，需要输入`user`的密码
- `user`缺省时默认为当前用户，一般来讲
- 特殊用法：直接`su root`需要使用`root`的密码，它一般是不知道或者处于安全考虑禁用的；而`sudo su`可以切换至`root`用户，只需输入自己的密码。

### `sudo`
- 用法：`sudo [-u <user>] <指令>`
- 以其它用户的身份执行指令
- 不使用`[-u <user>]`时默认为`root`用户
- 短期内首次使用时会要求输入**当前用户**的密码

### 与 `&&`、或 `||`
- 用法：`<指令1> && <指令2>`、`<指令1> || <指令2>`
- 前一个指令**成功**/**失败**时执行后一个指令
- 这两个用法可以类比 c 语言程序，当指令**成功**时返回值为0，因此它们类似于`if (func1()==0 && func2()==0) ;`（`||`同理）
- 注意：`sudo <指令>`将被当作一个指令整体，即`sudo <指令1> && <指令2>`只有指令1获得了超级用户权限

### 管道符 `|`
- 用法：`<指令1> | <指令2>`
- 简单来说，它是把指令1的输出作为指令2的输入进行执行
- 常见用于`grep`指令，例如`cat <file> | grep <text>`等价于`grep <text> <file>`

### 输出重定向符 `>`、 `>>`
- 用法：`<指令> > <file>`、`<指令> >> <file>`
- 将指令的输出放入`file`，前者会覆盖文件原本的内容，后者则增添到尾部
```
$ echo 123 > test
$ cat test
123
$ echo 456 >> test
$ cat test
123
456
$ echo 789 > test
$ cat test
789
```

### 安装软件
- 见[安装软件](install_program.md)一节

### `ssh`
- 见[ssh](../ssh.md)一节

### `git`
- 见[git](../git.md)一节

### 退出 `exit`
- 用法：`exit`
- 退出当前终端